# AutoZig - Safe Rust to Zig FFI bindings generator
# Inspired by autocxx for C++

[package]
name = "autozig"
version = "0.1.2"
authors = ["AutoZig Contributors"]
license = "MIT OR Apache-2.0"
description = "Safe autogenerated interop between Rust and Zig"
repository = "https://github.com/layola13/autozig"
homepage = "https://github.com/layola13/autozig"
documentation = "https://docs.rs/autozig"
edition = "2021"
keywords = ["ffi", "zig"]
categories = ["development-tools::ffi", "api-bindings"]
rust-version = "1.77"

resolver = "2"

[dependencies]
autozig-macro = { path = "macro", version = "0.1.2" }
tokio = { version = "1.0", features = ["sync"], optional = true }
futures = { version = "0.3", optional = true }

[dev-dependencies]
tokio = { version = "1.0", features = ["full"] }
futures = "0.3"

[workspace]
members = [
    "parser",
    "engine",
    "gen/build",
    "macro",
    "autozig-console",
    "demo",
    "examples/structs",
    "examples/enums",
    "examples/complex",
    "examples/smart_lowering",
    "examples/external",
    "examples/trait_calculator",
    "examples/trait_hasher",
    "examples/security_tests",
    "examples/generics",
    "examples/async",
    "examples/zig-c",
    "examples/stream_basic",
    "examples/simd_detect",
    "examples/zero_copy",
    "examples/wasm_filter",
    "examples/wasm_light",
    "examples/wasm64bit",
    "examples/modular_complex",
    "examples/array_param_test",
    "examples/array_ffi",
    "examples/abi_test",
    "examples/ffi_allocator",
    "examples/wasm64print",
    "examples/leak_test"
]

[features]
# Enable build-time code generation
build = []
# Enable stream support for async FFI
stream = ["tokio", "futures"]
default = []

# Profile 优化：大幅减少 target 目录体积
[profile.dev]
# 保留基本调试信息（行号），比 true (debug=2) 体积小 50%
debug = 1
# Linux 下加快链接速度，减少磁盘 IO
split-debuginfo = "unpacked"

# 关键配置：关闭依赖库的 debug 信息，大幅减少磁盘占用
[profile.dev.package."*"]
opt-level = 0
debug = 0           # 依赖库不需要 debug 符号
strip = "symbols"   # 剥离符号表

[profile.release]
opt-level = 3
lto = "thin"        # 启用瘦 LTO，平衡编译速度和性能
codegen-units = 16
strip = "symbols"   # Release 模式也剥离符号表